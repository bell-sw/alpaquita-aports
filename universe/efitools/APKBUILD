pkgname=efitools
pkgver=1.9.2
pkgrel=16
pkgdesc="EFI tools"
url="https://git.kernel.org/pub/scm/linux/kernel/git/jejb/efitools.git"
# others: limited by sbsigntool
arch="all !armhf !s390x !ppc64le !loongarch64"
license="(GPL-2.0-only AND LGPL-2.1-or-later) WITH OpenSSL-Exception"
options="!annobin !check" # no testsuite
# efi-readvar requires mount(8) with -l option
depends="mount"
makedepends="gnu-efi-dev gnu-efi openssl-dev>3 perl-file-slurp help2man sbsigntool"
subpackages="$pkgname-doc"
source="https://git.kernel.org/pub/scm/linux/kernel/git/jejb/efitools.git/snapshot/efitools-$pkgver.tar.gz
	001-datatypes.patch
	002-fix-parallel-make.patch
	003-fix-wchar_t.patch
	004-typo.patch
	fix-build-on-aarch64.patch

	0100-fix-strptime-usage.patch
	"

prepare() {
	default_prepare
	sed -i "s/-O2/$CFLAGS -Wno-pointer-sign -O2/" Make.rules
}

build() {
	export ARCH="$CARCH"
	make
}

package() {
	make DESTDIR="$pkgdir" install
}

sha512sums="
77e0ad7e865814ed388ff6daabe0f4b49ba51672bf2cbb98b7905e209cbd28f9ede2f73213ce45af8a978c1e67dba24ec88a1188661317cc22317b47e575cde8  efitools-1.9.2.tar.gz
cd72161a99b26472909a8da834c08a1f88b54d35291a6646562b03a6616fa5fb61e49d4fb3c780861689d23823c101709890dd245dd8aa9f51dca40ac1b2d369  001-datatypes.patch
7afe87e9b44ed3e10200770d3079e4e14b6d39c54c05538031e93d021631427fed47781b016b46f58b8fe6d21f1f3c78667b2b502aa20b99516aa980303aa2ad  002-fix-parallel-make.patch
dafe620f7eb3cbfe9538659da0936d704b11e176dbf544d12233c04c4d0edc7e46ebd4388edf886e907da7ba68dbd98828001369149b9fe3dfc7cba3f41ebea6  003-fix-wchar_t.patch
e34d4d8f420a29cfc50a9f98dcbb048016f2fc535ddb3e39482e58f44b37db672410ffab24392751818d72b1e914d77644cae8f7a92bb9af7fe2a9f726a230e9  004-typo.patch
92527e22ba385b0485508eb528d7338f202f2fc3174ef285a9fc7dfb339162bc95f98dbad0593043f0970034e99e8d027424e5a6924ea0a8c10e0c5b524e8f32  fix-build-on-aarch64.patch
64f2caa119b95221e4861286a6243652965ca4ec0a73bcc56d5cc4d554fc8da850ab9630ef05c0ad91ac0290018d467e0482565d130d0fe2728a522a5d5ea6eb  0100-fix-strptime-usage.patch
"
