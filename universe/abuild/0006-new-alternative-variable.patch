From ad5b14f56868c6ab6fd55c0869e7ad7efd98bf09 Mon Sep 17 00:00:00 2001
From: Alexey Kodanev <aleksei.kodanev@bell-sw.com>
Date: Tue, 1 Mar 2022 16:59:59 +0300
Subject: [PATCH] new 'alternative' variable

---
 APKBUILD.5.scd | 6 ++++++
 abuild.in      | 9 +++++++++
 2 files changed, 15 insertions(+)

diff --git a/APKBUILD.5.scd b/APKBUILD.5.scd
index c3dd6a7..20c947b 100644
--- a/APKBUILD.5.scd
+++ b/APKBUILD.5.scd
@@ -168,6 +168,12 @@ file.
 	Specifies packages that the package replaces. This is typically
 	used for packages renamed by upstream.
 
+*alternative*
+	Marks a package as an alternative to packages it conflicts with
+	(they have the same *provides*). When adding an alternative package,
+	it will remove the already installed alternative package that it
+	conflicts with.
+
 *subpackages*
 	Specifies subpackages or split packages built with this
 	package. Typically, this will include _$pkgname-dev_ for development
diff --git a/abuild.in b/abuild.in
index ca51e52..e668ebd 100644
--- a/abuild.in
+++ b/abuild.in
@@ -225,6 +225,11 @@ default_sanitycheck() {
 		die "provider_priority must be a number"
 	fi
 
+	if [ -n "$alternative" ] \
+		&& ! echo $alternative | egrep -q '^[01]$'; then
+		die "alternative must be a number: 0 or 1"
+	fi
+
 	# check so no package names starts with -
 	for i in $pkgname $subpackages; do
 		case $i in
@@ -1145,6 +1150,10 @@ prepare_metafiles() {
 		echo "provider_priority = $provider_priority" >> "$pkginfo"
 	fi
 
+	if [ -n "$alternative" ]; then
+		echo "alternative = $alternative" >> "$pkginfo"
+	fi
+
 	echo "license = $license" >> "$pkginfo"
 	for i in $replaces; do
 		echo "replaces = $i" >> "$pkginfo"
-- 
2.25.1

