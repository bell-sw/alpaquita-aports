From 4895c458b0c1f8237100c462887c5cfc4c840d9a Mon Sep 17 00:00:00 2001
From: Dmitry Klochkov <dmitry.klochkov@bell-sw.com>
Date: Thu, 7 Dec 2023 19:43:25 +0300
Subject: [PATCH] abuild: add option -X for skipping running the check command
 by default

---
 abuild.in | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/abuild.in b/abuild.in
index 9796e70..5af5007 100644
--- a/abuild.in
+++ b/abuild.in
@@ -126,6 +126,7 @@ cross_compiling() {
 }
 
 want_check() {
+	[ -n "$skip_check" ] && return 1
 	[ -n "$ABUILD_BOOTSTRAP" ] && return 1
 	cross_compiling && return 1
 	options_has "!check" && return 1
@@ -3006,6 +3007,7 @@ usage() {
 		 -r  Install missing dependencies from system repository (using sudo)
 		 -s  Set source package destination directory
 		 -v  Verbose: show every command as it is run (very noisy)
+		 -X  Skip running the check command by default
 
 		Commands:
 		  build       Compile and install package into \$pkgdir
@@ -3040,8 +3042,8 @@ usage() {
 }
 
 APKBUILD="${APKBUILD:-./APKBUILD}"
-unset color_opt force forceroot install_deps keep keep_build nodeps quiet verbose
-while getopts ":AcdD:fFhkKmnP:qrRs:uvV" opt; do
+unset color_opt force forceroot install_deps keep keep_build nodeps quiet verbose skip_check
+while getopts ":AcdD:fFhkKmnP:qrRs:uvVX" opt; do
 	case $opt in
 		'A') echo "$CARCH"; exit 0;;
 		'c') enable_colors
@@ -3062,6 +3064,7 @@ while getopts ":AcdD:fFhkKmnP:qrRs:uvV" opt; do
 		's') SRCDEST=$OPTARG;;
 		'v') verbose="-v"; set -x;;
 		'V') echo "$program $program_version"; exit 0;;
+		'X') skip_check="-X";;
 		'?') error "Unrecognized option: $OPTARG"; usage >&2; exit 1;;
 	esac
 done
-- 
2.42.1

