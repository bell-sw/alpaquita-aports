pkgname=shim-signed

_build_x86_64="20240312"
_build_aarch64="20240508"
case "$CARCH" in
x86_64)
	_efi_sfx="x64"
	pkgver=15.7
	pkgrel=4
	;;
aarch64)
	_efi_sfx="aa64"
	pkgver=15.8
	pkgrel=0
	;;
esac

pkgdesc="shim, a first-stage UEFI bootloader (signed)"
url="https://github.com/rhboot/shim"
arch="x86_64 aarch64"
license="BSD-2-Clause-Patent"
makedepends="sbsigntool"
options="!strip !check !tracedeps"
install="$pkgname.post-install $pkgname.post-upgrade"
source="
	$VENDOR_REPO_BASE_URL/$VENDOR_DISTRO/distfiles/shim-$_build_x86_64.x86_64.tar.xz
	$VENDOR_REPO_BASE_URL/$VENDOR_DISTRO/distfiles/shim-$_build_aarch64.aarch64.tar.xz
	../shim/bellsoft-uefi-ca.pem
"
builddir="$srcdir/shim-$(eval "echo \$_build_$CARCH").$CARCH"
_efi="boot/efi/EFI"

sign_list="
	$_efi/BOOT/mm${_efi_sfx}.efi
	$_efi/$VENDOR_DISTRO/mm${_efi_sfx}.efi
	$_efi/BOOT/fb${_efi_sfx}.efi
"
sign_verify="bellsoft-uefi-ca.pem"

package() {
	mkdir -p "$pkgdir"
	cp -rf "$builddir"/boot "$pkgdir"
}

sha512sums="
798dc70715b1772e3763b774bb4ad775137f1e3c26cfdff2590cfb63b1ed025411c009c5153a13fa8d88dd50c376995581c9dbf370d584e02eefef0ec0427e62  shim-20240312.x86_64.tar.xz
2d793d62c8464c159868207379cf607591fdef9a9cca6687f271fbaf5fa6408ef6434615e53b57bd3e2db014eb43e3c20cfedec82f1da65e8917dbb6f93e940d  shim-20240508.aarch64.tar.xz
304d6a2d2c25af142b2cf2222079ebf59b8174f0825840dfc88e60016e5fcfe12973e0a250b4172ff7ea77cdb014cb5fec1a474965fee97478a6dcd0cbe6bdd3  bellsoft-uefi-ca.pem
"
