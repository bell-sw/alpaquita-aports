# Description: provides a portable framework for low-level network monitoring.

pkgname=libpcap
pkgver=1.10.2
pkgrel=0
pkgdesc="A userspace library to capture network traffic"
url="https://www.tcpdump.org/"
arch="all"
license="BSD-3-Clause"
options="!check"
makedepends="bison flex autoconf linux-headers"
source="https://www.tcpdump.org/release/libpcap-$pkgver.tar.gz
	musl:fix-headers.patch
	"
subpackages="$pkgname-doc $pkgname-dev"

# secfixes:
#   1.9.1-r0:
#     - CVE-2018-16301
#     - CVE-2019-15161
#     - CVE-2019-15162
#     - CVE-2019-15163
#     - CVE-2019-15164
#     - CVE-2019-15165

build() {
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--localstatedir=/var \
		--enable-ipv6

	# seems to be problem with timestamps
	sleep 1
	./config.status

	make all shared
}

package() {
	make -j1 DESTDIR="$pkgdir" install install-shared
}

sha512sums="
ccacebf367db44ab74e588f88a4fd7cd82c58e478e6c35414ae36df58fb06d85d542597485b1d1393edfaacc2bc5d35578b7b87fee4965f6dfde10a03d2ddd32  libpcap-1.10.2.tar.gz
77590c8fcea96427fd08e85023609695f8b280a9b24a503d19b08a3c6baf3537a949c94078a5cd577f0476d735a257050955590374d85ce6a2f35a09143da5a3  fix-headers.patch
"
