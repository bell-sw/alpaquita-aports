From c4ecee561ca9f93ee13e4d6295af8adc77e50208 Mon Sep 17 00:00:00 2001
From: Paul Zimmermann <Paul.Zimmermann@inria.fr>
Date: Mon, 12 Dec 2022 10:42:12 +0100
Subject: [PATCH] added test for case when stdio.h is not included

---
 src/mpc-impl.h    |  2 ++
 tests/Makefile.am |  2 +-
 tests/mpc-tests.h |  2 ++
 tests/tdummy.c    | 33 +++++++++++++++++++++++++++++++++
 4 files changed, 38 insertions(+), 1 deletion(-)
 create mode 100644 tests/tdummy.c

diff --git a/src/mpc-impl.h b/src/mpc-impl.h
index 2b7bbb2..a915751 100644
--- a/src/mpc-impl.h
+++ b/src/mpc-impl.h
@@ -27,7 +27,9 @@ along with this program. If not, see http://www.gnu.org/licenses/ .
 #ifdef HAVE_STDLIB_H
 #include <stdlib.h>
 #endif
+#ifndef DONT_INCLUDE_STDIO
 #include <stdio.h>
+#endif
 #include "mpc.h"
 
 /*
diff --git a/tests/Makefile.am b/tests/Makefile.am
index f488bdb..2fe0813 100644
--- a/tests/Makefile.am
+++ b/tests/Makefile.am
@@ -45,7 +45,7 @@ check_PROGRAMS = tradius tballs teta                                    \
   treimref trootofunity                                                 \
   tset tsin tsin_cos tsinh tsqr tsqrt tstrtoc tsub tsub_fr	        \
   tsub_ui tsum tswap ttan ttanh tui_div tui_ui_sub                      \
-  tget_version texceptions
+  tget_version texceptions tdummy
 
 check_LTLIBRARIES=libmpc-tests.la
 libmpc_tests_la_SOURCES = mpc-tests.h check_data.c clear_parameters.c	\
diff --git a/tests/mpc-tests.h b/tests/mpc-tests.h
index ecd10b7..57ac632 100644
--- a/tests/mpc-tests.h
+++ b/tests/mpc-tests.h
@@ -22,7 +22,9 @@ along with this program. If not, see http://www.gnu.org/licenses/ .
 #define __MPC_TESTS_H
 
 #include "config.h"
+#ifndef DONT_INCLUDE_STDIO
 #include <stdio.h>
+#endif
 #include <ctype.h>
 #include <stdlib.h>
 #include <inttypes.h> /* for the PRIi64 format modifier */
diff --git a/tests/tdummy.c b/tests/tdummy.c
new file mode 100644
index 0000000..23072f5
--- /dev/null
+++ b/tests/tdummy.c
@@ -0,0 +1,33 @@
+/* tdummy -- test file when stdio.h is not included
+
+Copyright (C) 2022 INRIA
+
+This file is part of GNU MPC.
+
+GNU MPC is free software; you can redistribute it and/or modify it under
+the terms of the GNU Lesser General Public License as published by the
+Free Software Foundation; either version 3 of the License, or (at your
+option) any later version.
+
+GNU MPC is distributed in the hope that it will be useful, but WITHOUT ANY
+WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
+FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for
+more details.
+
+You should have received a copy of the GNU Lesser General Public License
+along with this program. If not, see http://www.gnu.org/licenses/ .
+*/
+
+#define DONT_INCLUDE_STDIO
+#include "mpc-tests.h"
+
+int
+main (void)
+{
+  test_start ();
+
+  test_end ();
+
+  return 0;
+}
+
-- 
GitLab

