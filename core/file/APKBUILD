# Description: file package identifies the file type by means of looking into 
# the file content.

pkgname=file
pkgver=5.43
pkgrel=0
pkgdesc="File type recognition tool"
url="https://www.darwinsys.com/file/"
arch="all"
license="BSD-2-Clause"
makedepends="autoconf libtool automake"
subpackages="$pkgname-dev $pkgname-doc libmagic"
source="$pkgname-$pkgver.tar.gz::https://github.com/file/file/archive/FILE${pkgver/./_}.tar.gz
	fix-dsf-format.patch
	"
builddir="$srcdir/$pkgname-FILE${pkgver/./_}"

# secfixes:
#   5.37-r1:
#     - CVE-2019-18218
#   5.36-r0:
#     - CVE-2019-1543
#     - CVE-2019-8904
#     - CVE-2019-8905
#     - CVE-2019-8906
#     - CVE-2019-8907

build() {
	SH_LIBTOOL='/usr/share/build-1/libtool' autoreconf -f -i
	./configure \
		--build=$CBUILD \
		--host=$CHOST \
		--prefix=/usr \
		--datadir=/usr/share
	make
}

check() {
	make check
}

package() {
	make DESTDIR="$pkgdir" install
}

libmagic() {
	pkgdesc="File type identification library"
	mkdir -p "$subpkgdir"/usr
	mv "$pkgdir"/usr/lib "$pkgdir"/usr/share "$subpkgdir"/usr
}

sha512sums="
a961136cd89794bf45eb107fbe7785603b5d40363d0634c6c85e96d4ca9f85087c98442ca1fb0089beff60e9c3a49aa6acab8b67416e72b7d32c67ad5b1d1fa2  file-5.43.tar.gz
d1f671e35181fbe7f5332585a50ff0fb889d37090f4cf5bcba851f26b07c8bebbc8f52f2e4a6ca5f5cec7fa087e40c9a1293a5acd1987c8ea91151f2ee94464f  fix-dsf-format.patch
"
